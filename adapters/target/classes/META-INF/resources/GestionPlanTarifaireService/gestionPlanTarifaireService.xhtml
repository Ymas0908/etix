<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" xmlns:f="http://xmlns.jcp.org/jsf/core"
                template="/WEB-INF/template.xhtml">

    <ui:define name="title">Gestion des plans tarifaire des services</ui:define>

    <ui:define name="viewname">
        <li>PLAN TARIFAIRE DE SERVICE</li>
        <li>
            <p:link outcome="/GestionPlanTarifaireService/gestionPlanTarifaireService"> GESTION DE PLAN TARIFAIRE DE SERVICE </p:link>
        </li>
    </ui:define>

    <ui:define name="content">
        <h:form id="planTarifaireServiceForm">
            <div class="grid">
                <div class="col-12">
                    <div class="card">
                        <div class="grid">
                            <div class="col-12">
                                <h3 class="font-bold mb-4">Gestion des plans tarifaire service </h3>
                            </div>
                        </div>
                        <div class="flex mb-2">
                            <div class="flex-1 flex flex-column">
                                <h5>Liste des contributeurs (#{creationDePlanTarifaireDeServiceMB.contributeurs.size()})</h5>
                            </div>
                        </div>
                        <div class="grid">
                            <div class="col-12">
                                <p:dataTable id="idListContributeur" widgetVar="dtListContribs"
                                             var="contributeur"
                                             value="#{creationDePlanTarifaireDeServiceMB.contributeurs}"
                                             reflow="true"
                                             selection="#{creationDePlanTarifaireDeServiceMB.contributeur}"
                                             emptyMessage="Aucun contributeur trouvé"
                                             rowKey="#{contributeur.ID}" scrollable="true" scrollHeight="260px"
                                             styleClass=" ">
                                    <p:ajax event="rowSelect"
                                            update="paysContributeurForm,mmpForm"
                                            listener="#{creationDePlanTarifaireDeServiceMB.collecterLesPaysDeOperationParContributeur()}"
                                    />
                                    <p:column headerText="Raison sociale" filterBy="#{contributeur.raisonSociale}">
                                        <h:outputText value="#{contributeur.raisonSociale}"/>
                                    </p:column>
                                    <p:column headerText="Nom du dirigeant" filterBy="#{contributeur.nomDirigeant}">
                                        <h:outputText value="#{contributeur.nomDirigeant}"/>
                                    </p:column>
                                    <p:column headerText="Statut Contributeur"
                                              filterBy="#{contributeur.statutContributeur}">
                                        <h:outputText value="#{contributeur.statutContributeur}"/>
                                    </p:column>
                                    <p:column headerText="Type du contributeur"
                                              filterBy="#{contributeur.typeContributeur}">
                                        <h:outputText value="#{contributeur.typeContributeur}"/>
                                    </p:column>
                                </p:dataTable>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </h:form>

        <div class="grid mt-1">
            <div class="col-12 md:col-6 lg:col-6">
                <h:form id="paysContributeurForm">
                    <div class="card">
                        <h5 class="ui-subtitle">Liste des pays par contributeurs (#{creationDePlanTarifaireDeServiceMB.paysList.size()})</h5>
                        <div class="ui-form-icon flex">
                            <p:dataTable id="idListPays" widgetVar="dtListPaysContribs3" scrollable="true"
                                         scrollHeight="150" scrollRows="20"
                                         var="pays"
                                         value="#{creationDePlanTarifaireDeServiceMB.paysList}"
                                         selection="#{creationDePlanTarifaireDeServiceMB.pays}"
                                         emptyMessage="Aucun pays trouvé"
                                         lazy="true"
                                         rowKey="#{pays.ID}" style="margin-bottom:0; height: 200px">
                                <p:ajax event="rowSelect"
                                        update="mmpForm"
                                        listener="#{creationDePlanTarifaireDeServiceMB.collecterLesMmpParPaysDeOperation()}"/>

                                <p:column headerText="Nom">
                                    <h:outputText value="#{pays.nom}"/>
                                </p:column>
                                <p:column headerText="Code ISO">
                                    <h:outputText value="#{pays.codeIso}"/>
                                </p:column>

                                <p:column headerText="Nationalite">
                                    <h:outputText value="#{pays.nationalite}"/>
                                </p:column>
                            </p:dataTable>
                        </div>
                    </div>
                </h:form>
            </div>
            <div class="col-12 md:col-6 lg:col-6">
                <h:form id="mmpForm">
                    <div class="card">
                        <h5 class="ui-subtitle">Liste des mini-places de marché par pays (#{creationDePlanTarifaireDeServiceMB.mmps.size()}) </h5>
                        <div class="ui-form-icon flex">
                            <p:dataTable id="idListMmp" widgetVar="dtContribs2"
                                         var="mmp"
                                         value="#{creationDePlanTarifaireDeServiceMB.mmps}"
                                         reflow="true"
                                         selection="#{creationDePlanTarifaireDeServiceMB.mmp}"
                                         emptyMessage="Aucune mmp trouvé"
                                         lazy="false"
                                         rowKey="#{mmp.id}" scrollable="true" scrollHeight="150px" scrollRows="20"
                                         style="margin-bottom:0; height: 200px">
                                <p:ajax event="rowSelect"
                                        update="serviceForm,tarifServiceForm,editerTarifServiceForm"
                                        listener="#{creationDePlanTarifaireDeServiceMB.collecterLesServicesParContributeurParMmp()}"/>
                                <p:column headerText="Libelle">
                                    <h:outputText value="#{mmp.libelle}"/>
                                </p:column>

                                <p:column headerText="Statut">
                                    <h:outputText value="#{mmp.statutMmp}"/>
                                </p:column>
                                <p:column headerText="Action" width="3em">
                                    <p:commandButton icon="pi pi-pencil"
                                                     styleClass="rounded-button"
                                                     update="serviceForm,tarifServiceForm,editerTarifServiceForm"
                                                     process="mmpForm"
                                                     action="#{creationDePlanTarifaireDeServiceMB.selectContributeurAndPaysAndMmp()}">
                                        <f:setPropertyActionListener value="#{mmp}"
                                                                     target="#{creationDePlanTarifaireDeServiceMB.mmp}"/>
                                    </p:commandButton>
                                </p:column>
                            </p:dataTable>
                        </div>
                    </div>
                </h:form>
            </div>
        </div>

        <p:sidebar widgetVar="plantarifaireServiceSidebar"
                   styleClass="w-full lg:w-6 h-full overflow-y-auto"
                   position="right">
            <div class="grid mt-1">
                <div class="col-12 md:col-6 lg:col-12">
                    <h:form id="serviceForm">
                        <div class="card">
                            <h5 class="ui-subtitle">Liste des services par contributeurs et mmp (#{creationDePlanTarifaireDeServiceMB.services.size()})</h5>
                            <div class="ui-form-icon flex">
                                <p:dataTable id="idListdesservices" widgetVar="dtListServices" scrollable="true"
                                             scrollHeight="150" scrollRows="20"
                                             var="service"
                                             value="#{creationDePlanTarifaireDeServiceMB.services}"
                                             selection="#{creationDePlanTarifaireDeServiceMB.service}"
                                             emptyMessage="Aucun service trouvé"
                                             lazy="true"
                                             rowKey="#{service.ID}" style="margin-bottom:0; height: 200px">
                                    <p:ajax event="rowSelect" update="tarifServiceForm"
                                            listener="#{creationDePlanTarifaireDeServiceMB.collecterLesTarifsDeServices()}"/>
                                    <p:ajax event="rowUnselect" update="tarifServiceForm"/>
                                    <p:column headerText="Libelle">
                                        <h:outputText value="#{service.libelle}"/>
                                    </p:column>
                                    <p:column headerText="Statut">
                                        <h:outputText value="#{service.statutService}"/>
                                    </p:column>
                                </p:dataTable>
                            </div>
                        </div>
                    </h:form>
                </div>
            </div>

            <div class="grid mt-1">
                <div class="col-12 md:col-6 lg:col-12">
                    <h:form id="tarifServiceForm">
                        <div class="card">
                            <h5 class="ui-subtitle">Liste des tarifs service (#{creationDePlanTarifaireDeServiceMB.tarifServices.size()})</h5>
                            <div class="ui-form-icon flex">
                                <p:dataTable id="idListeTarifService2" widgetVar="dtListeTarifService" scrollRows="20"
                                             scrollHeight="150"
                                             var="tarifService"
                                             scrollable="true"
                                             value="#{creationDePlanTarifaireDeServiceMB.tarifServices}"
                                             selection="#{creationDePlanTarifaireDeServiceMB.tarifService}"
                                             emptyMessage="Aucun tarif service trouvé"
                                             lazy="true"
                                             rowKey="#{tarifService.ID}" style="margin-bottom:0; height: 200px">
                                    <p:ajax event="rowSelect"
                                            update="editerTarifServiceForm"/>
                                    <p:column headerText="Montant forfait">
                                        <h:outputText value="#{tarifService.montantForfait}"/>
                                    </p:column>
                                    <p:column headerText="Type tarif">
                                        <h:outputText value="#{tarifService.typeTarif}"/>
                                    </p:column>
                                    <p:column headerText="Statut">
                                        <h:outputText value="#{tarifService.statutService}"/>
                                    </p:column>
                                    <p:column headerText="Action" width="10em">
                                        <p:commandButton icon="pi pi-database" styleClass="rounded-button mr-1"
                                                         update="historiserTarifServiceForm" process="tarifServiceForm"
                                                         action="#{creationDePlanTarifaireDeServiceMB.selectTarifService()}"
                                                         title="Historiser le tarif service">
                                            <f:setPropertyActionListener value="#{tarifService}"
                                                                         target="#{creationDePlanTarifaireDeServiceMB.tarifService}"/>
                                        </p:commandButton>
                                    </p:column>
                                </p:dataTable>
                            </div>
                        </div>
                    </h:form>
                </div>
            </div>

            <h:form id="editerTarifServiceForm">
                <div class="card">
                    <div class="col-12">
                        <div class="ui-fluid formgrid grid">
                            <div class="field col-6 md:col-6">
                                <p:outputLabel for="@next" value="Montant forfait"/>
                                <p:inputText id="montantForfait"
                                             placeholder="Saisir le montant"
                                             value="#{creationDePlanTarifaireDeServiceMB.tarifService.montantForfait}"/>
                            </div>

                            <div class="field col-6 md:col-6">
                                <p:outputLabel for="@next" value="Type"/>
                                <p:selectOneMenu id="idType"
                                                 value="#{creationDePlanTarifaireDeServiceMB.tarifService.typeTarif}">
                                    <f:selectItem itemLabel="Selectionnez un type"
                                                  itemValue="#{creationDePlanTarifaireDeServiceMB.typeTarif}"/>
                                    <f:selectItems value="#{creationDePlanTarifaireDeServiceMB.typeTarifs}" var="type"
                                                   itemLabel="#{type}" itemValue="#{type}"/>
                                </p:selectOneMenu>
                            </div>

                            <div class="field col-6 md:col-6">
                                <p:outputLabel for="@next" value="Pourcentage"/>
                                <p:inputNumber id="pourcentage" maxValue="100"
                                               placeholder="Saisir le pourcentage "
                                               value="#{creationDePlanTarifaireDeServiceMB.tarifService.pourcentageForfait}"/>
                            </div>
                            <div class="field col-10">
                                <div class="flex">
                                    <p:commandButton value="Enregistrer"
                                                     action="#{creationDePlanTarifaireDeServiceMB.creerUnTarifDeService()}"
                                                     update="tarifServiceForm, editerTarifServiceForm"
                                                     process="editerTarifServiceForm"
                                                     styleClass="w-auto mr-2"/>
                                    <p:commandButton value="Annuler"
                                                     process="@this"
                                                     action="#{creationDePlanTarifaireDeServiceMB.initPlanTarifaire()}"
                                                     update="editerTarifServiceForm"
                                                     icon="pi pi-times"
                                                     styleClass="w-auto"/>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </h:form>
        </p:sidebar>

        <p:sidebar widgetVar="historiserTarifServiceSidebar" position="right"
                   styleClass="w-full lg:w-6 h-full overflow-y-auto">
            <h:form id="historiserTarifServiceForm">
                <div class="card">
                    <h5 class="ui-subtitle">Liste des tarifs service Historisés (#{creationDePlanTarifaireDeServiceMB.historiqueTarifServices.size()})</h5>
                    <div class="ui-form-icon flex">
                        <p:dataTable id="idListeTarifServicehist" widgetVar="dtListeTarifService1" scrollRows="2"
                                     scrollHeight="150"
                                     var="tarifServiceHist"
                                     scrollable="true"
                                     value="#{creationDePlanTarifaireDeServiceMB.historiqueTarifServices}"
                                     selection="#{creationDePlanTarifaireDeServiceMB.historiqueTarifService}"
                                     emptyMessage="Aucun tarif service hist trouvé"
                                     lazy="true"
                                     rowKey="#{tarifServiceHist.ID}" style="margin-bottom:0; height: 200px">
                            <p:column headerText="Montant forfait">
                                <h:outputText value="#{tarifServiceHist.montantForfait}"/>
                            </p:column>
                            <p:column headerText="Tarif service">
                                <h:outputText value="#{tarifServiceHist.tarifService.service.libelle}"/>
                            </p:column>
                            <p:column headerText="Pourcentage">
                                <h:outputText value="#{tarifServiceHist.pourcentageForfait}"/>
                            </p:column>
                            <div class="flex justify-content-start flex-wrap mt-2">
                                <p:column headerText="Action">
                                    <p:commandButton value="Supprimer" process="@this"
                                                     update="historiserTarifServiceForm"
                                                     action="#{creationDePlanTarifaireDeServiceMB.supprimerLesHistoriquesDeTarifsDeService()}"
                                                     icon="pi pi-trash"
                                                     styleClass="w-auto mr-2">
                                    </p:commandButton>
                                </p:column>
                            </div>
                        </p:dataTable>
                    </div>
                </div>

                <div class="grid">
                    <div class="col-12">
                        <p:divider styleClass="mb-2"/>
                        <div class="ui-fluid formgrid grid">
                            <div class="ui-fluid formgrid grid">
                                <div class="field col-12">
                                    <div class="field col-12 md:col-12 ">
                                        <p:outputLabel value="Faire une annotation"/>
                                        <p:inputTextarea id="deleteServiceTypeSideAnnotation"
                                                         required="true"
                                                         value="#{creationDePlanTarifaireDeServiceMB.annotation.commentaire}"
                                                         placeholder="Saisir un commentaire..." rows="5"
                                                         cols="255"/>
                                    </div>
                                </div>
                            </div>
                            <div class="flex justify-content-start flex-wrap mt-2">
                                <p:commandButton value="Historiser" process="@this"
                                                 update=" tarifServiceForm, historiserTarifServiceForm "
                                                 action="#{creationDePlanTarifaireDeServiceMB.historiserUnTarifDeService()}"
                                                 icon="pi pi-trash"
                                                 styleClass="w-auto mr-2">
                                </p:commandButton>
                                <p:commandButton value="Annuler" process="@this"
                                                 action="#{creationDePlanTarifaireDeServiceMB.initHistoriqueTarifService()}"
                                                 update="historiserTarifServiceForm"
                                                 icon="pi pi-times" styleClass="w-auto "/>
                            </div>
                        </div>
                    </div>
                </div>

            </h:form>

        </p:sidebar>

    </ui:define>
</ui:composition>