<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="title">Mini market place</ui:define>

    <ui:define name="viewname">
        <li>GESTION DES MINIS PLACES DE MARCHE</li>
        <li><i class="pi pi-chevron-right"></i></li>
        <li>
            <p:link outcome="/gestion-mmp-services/mini-market-place">EDITION DES MINIS PLACES DE MARCHE</p:link>
        </li>
    </ui:define>

    <ui:define name="content">
        <!-- formulaire pour la création d'une mmp -->
        <h:form id="miniplaceForm">
            <div class="grid">
                <div class="col">
                    <div class="card">
                        <h3 class="font-bold "> Gestion des mini-places de marché </h3>

                        <!-- div créer une mmp -->
                        <div class="flex mt-3 mb-2">
                            <div class="flex-1 flex flex-column">
                                <h5>Liste des mini-places de marché (#{creationDeMmpMB.mmpList.size()})</h5>
                            </div>

                            <!-- Btn créer une mmp -->
                            <div class="flex align-items-center justify-content-center">
                                <p:commandButton value="Créer une mini-place de marché" icon="pi pi-plus"
                                                 styleClass="w-auto"
                                                 update="creationMarForm"
                                                 action="#{creationDeMmpMB.showCreationMmpSidebar()}"
                                                 title="Nouvelle mini-place de marche"/>
                            </div>
                            <!-- Btn créer une mmp -->
                        </div>
                        <!-- div créer une mmp -->

                        <div class="grid">
                            <div class="col-12">
                                <!-- Début dataTable -->
                                <p:dataTable id="contribs" widgetVar="dtContribus"
                                             scrollable="true" scrollHeight="500" lazy="false"
                                             var="mmp" value="#{creationDeMmpMB.mmpList}" reflow="true"
                                             emptyMessage="Aucune mini-place de marché"
                                             rowKey="#{mmp.ID}">

                                    <!-- Header Logo -->
                                    <p:column headerText="Logo">
                                        <p:avatar styleClass="mr-2" size="large" shape="circle">
                                            <p:graphicImage
                                                    value="#{'/resources/poseidon-layout/images/marketing.svg'}"/>
                                        </p:avatar>
                                    </p:column>
                                    <!-- Header Logo -->

                                    <!-- Header Libelle -->
                                    <p:column id="libelle" headerText="Libellé" filterBy="#{mmp.libelle}">
                                        <h:outputText value="#{mmp.libelle}"/>
                                    </p:column>
                                    <!-- Header Libelle -->
                                    <p:column headerText="Type" filterBy="#{mmp.typeMmp.toString()}">
                                        <f:facet name="filter">
                                            <p:selectOneMenu onchange="PF('dtContribus').filter()"
                                                             styleClass="ui-custom-filter"
                                                             value="#{creationDeMmpMB.typeMmp}">
                                                <f:selectItem itemLabel="TOUS" itemValue="#{null}"
                                                              noSelectionOption="true"/>
                                                <f:selectItems value="#{creationDeMmpMB.typeMmps}"/>
                                            </p:selectOneMenu>
                                        </f:facet>
                                        <h:outputText value="#{mmp.typeMmp.toString()}"/>
                                    </p:column>
                                    <!-- Header Statut -->
                                    <p:column headerText="Statut" filterBy="#{mmp.statutMmp}">
                                        <f:facet name="filter">
                                            <p:selectOneMenu onchange="PF('dtContribus').filter()"
                                                             styleClass="ui-custom-filter"
                                                             value="#{creationDeMmpMB.statutMmp}">
                                                <f:selectItem itemLabel="TOUS" itemValue="#{null}"
                                                              noSelectionOption="true"/>
                                                <f:selectItems value="#{creationDeMmpMB.listStatutMmp}"/>
                                            </p:selectOneMenu>
                                        </f:facet>
                                        <h:outputText value="#{mmp.statutMmp}"/>
                                    </p:column>


                                    <!-- Header Statut -->

                                    <!-- Header Actions ainsi que les btn d'action -->
                                    <p:column headerText="Actions" width="10em">
                                        <!-- Btn modifier -->
                                        <p:commandButton icon="pi pi-pencil"
                                                         action="#{creationDeMmpMB.showModificationMmpSidebar()}"
                                                         title="Modifier"
                                                         update="creationMarForm"
                                                         styleClass="edit-button rounded-button mr-1">
                                            <f:setPropertyActionListener value="#{mmp}"
                                                                         target="#{creationDeMmpMB.mmp}"/>
                                        </p:commandButton>
                                        <!-- Btn modifier -->

                                        <!-- Btn Activer/Désactiver -->
                                        <p:commandButton icon="pi pi-shopping-bag"
                                                         action="#{creationDeMmpMB.showActiverDesactiverMmpSidebar()}"
                                                         title="Activer/Désactiver un MMP"
                                                         update="editMiniPlace"
                                                         styleClass="edit-button rounded-button mr-1">
                                            <f:setPropertyActionListener value="#{mmp}"
                                                                         target="#{creationDeMmpMB.mmp}"/>
                                        </p:commandButton>
                                        <!-- Btn Activer/Désactiver -->

                                        <!-- Btn Supprimer et gestion (Msg de confirmation de suppression) -->
                                        <p:commandButton action="#{creationDeMmpMB.supprimerUneMmp()}"
                                                         update="miniplaceForm"
                                                         process="miniplaceForm"
                                                         icon="pi pi-trash"
                                                         title="Supprimer"
                                                         styleClass="delete-button rounded-button mr-1">
                                            <p:confirm header="Attention!"
                                                       message="Voulez-vous vraiment supprimer cette mini-place de marché ?"
                                                       icon="pi pi-info-circle"/>
                                            <f:setPropertyActionListener value="#{mmp}"
                                                                         target="#{creationDeMmpMB.mmp}"/>
                                        </p:commandButton>
                                        <!-- Btn Supprimer et gestion (Msg de confirmation de suppression) -->
                                    </p:column>
                                </p:dataTable>
                                <!-- Fin dataTable -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </h:form>
        <!-- formulaire pour la création d'une mmp -->

        <!-- Sidebar pour la création/édition d'une mini-place de marché -->
        <p:sidebar widgetVar="sidebarcreation" styleClass="w-full lg:w-6 h-full overflow-y-auto" position="right">
            <h:form id="creationMarForm">
                <div class="card">
                    <div class="grid">
                        <div class="col-12">
                            <h4 class="font-bold">Édition d'une mini-place de marché</h4>
                            <p:divider styleClass="mb-3"/>

                            <h6 class="my-3">
                                <i class="pi pi-info-circle mr-1"></i>Veuillez renseigner les champs suivants :
                            </h6>

                            <div class="ui-fluid">

                                <!--champ libellé-->
                                <div class="field">
                                    <p:outputLabel for="@next" value="Libellé"/>
                                    <p:inputText required="true" requiredMessage="Veuillez saisir le libellé."
                                                 value="#{creationDeMmpMB.mmp.libelle}" placeholder="Ex : Forum"/>
                                </div>
                                <div class="field">
                                    <p:outputLabel for="@next" value="Type"/>
                                    <p:selectOneMenu required="true" requiredMessage="Veuillez choisir le type."
                                                     value="#{creationDeMmpMB.mmp.typeMmp}">
                                        <f:selectItem itemLabel="Selectionnez un type" itemValue="#{null}"/>
                                        <f:selectItems value="#{creationDeMmpMB.typeMmps}"/>
                                    </p:selectOneMenu>
                                </div>
                                <!--champ libellé-->

                                <!--champ description-->
                                <div class="field">
                                    <p:outputLabel for="@next" value="Description"/>
                                    <p:inputTextarea value="#{creationDeMmpMB.mmp.description}"
                                                     placeholder="Saisir une description..." rows="5" cols="255"/>
                                </div>
                                <!--champ description-->

                                <!--champ pour uploader une image-->
                                <div class="field">
                                    <p:fileUpload mode="advanced"
                                                  multiple="false"
                                                  sizeLimit="11102400"
                                                  allowTypes="/(\.|\/)(gif|jpe?g|png)$/"
                                                  uploadLabel="Téléverser"
                                                  cancelLabel="Annuler"
                                                  label="Choisir un fichier"
                                                  listener="#{creationDeMmpMB.handleFileUpload}"/>
                                </div>
                                <!--champ pour uploader une image-->
                            </div>

                            <!--btn enregistrer, modifier et annuler-->
                            <div class="flex justify-content-start flex-wrap mt-2">
                                <p:commandButton value="Enregistrer"
                                                 rendered="#{creationDeMmpMB.mmp.id == null}"
                                                 action="#{creationDeMmpMB.creerUneMmp()}"
                                                 process="creationMarForm" icon="pi pi-check"
                                                 styleClass="w-auto mr-2" update="miniplaceForm"/>

                                <p:commandButton value="Modifier"
                                                 rendered="#{creationDeMmpMB.mmp.id != null}"
                                                 action="#{creationDeMmpMB.modifierUneMmp()}"
                                                 process="creationMarForm" icon="pi pi-check"
                                                 styleClass="w-auto mr-2" update="miniplaceForm"/>

                                <p:commandButton value="Annuler"
                                                 update="creationMarForm,miniplaceForm"
                                                 process="@this"
                                                 icon="pi pi-times" styleClass="w-auto"
                                                 action="#{creationDeMmpMB.reset()}"/>
                            </div>
                            <!--btn enregistrer, modifier et annuler-->
                        </div>
                    </div>
                </div>
            </h:form>
        </p:sidebar>
        <!-- Sidebar pour la création/édition d'une mini-place de marché -->

        <!-- Sidebar pour Activer/Désactiver une mini-place de marché -->
        <p:sidebar widgetVar="sidebaractiverdesactiver" styleClass="w-full lg:w-6 h-full overflow-y-auto"
                   position="right">
            <!--tabView  pour services types et Activation des services-->
            <p:tabView id="editMiniPlace" styleClass="p-0">
                <!--tab : services types-->
                <p:tab title="Services types">
                    <div class="grid">

                        <!--rattacher/detacher services types : service types non rattachés-->
                        <div class="col-12 md:col-6 lg:col-6">
                            <h:form id="serviceTypeNonRattacheForm" class="ui-fluid">
                                <h5 class="ui-subtitle">Liste des services-type non rattachés (#{creationDeMmpMB.listeServiceTypeNonRattach.size()})</h5>
                                <div class="ui-form-icon flex mb-3">
                                    <i class="pi pi-info-circle mr-1"></i>
                                    <span>Veuillez selectionner les services type ci-dessous et cliquer sur le boutton "Rattacher"</span>
                                </div>
                                <p:dataTable scrollable="true" scrollHeight="350"
                                             var="servType" lazy="true"
                                             emptyMessage="Aucun service type non rattaché trouvé."
                                             value="#{creationDeMmpMB.listeServiceTypeNonRattach}"
                                             selection="#{creationDeMmpMB.serviceTypeNonRattachSelec}"
                                             rowKey="#{servType.ID}"
                                             style="margin-bottom:0; height: 100px">
                                    <p:column selectionMode="multiple"
                                              style="width:16px;text-align:center"/>
                                    <p:column headerText="Nom">
                                        <h:outputText value="#{servType.libelle}"/>
                                    </p:column>
                                    <p:column headerText="Statut">
                                        <h:outputText value="#{servType.statutServiceType.toString()}"/>
                                    </p:column>
                                </p:dataTable>
                                <div class="p-col-12 p-lg-6 p-md-6">
                                    <p:commandButton value="Rattacher" style="width: 100px; margin-top: 70%"
                                                     process="serviceTypeNonRattacheForm"
                                                     update="serviceTypeNonRattacheForm,editMiniPlace:serviceTypeRattacheForm"
                                                     disabled="#{creationDeMmpMB.listeServiceTypeNonRattach.size() == 0}"
                                                     action="#{creationDeMmpMB.rattacherServiceTypes()}"
                                                     icon="pi pi-save"/>
                                </div>
                            </h:form>
                        </div>
                        <!--rattacher/detacher services types : service types non rattachés-->

                        <!--rattacher/detacher services types : service types rattachés-->
                        <div class="col-12 md:col-6 lg:col-6">
                            <h:form id="serviceTypeRattacheForm" class="ui-fluid">
                                <h5 class="ui-subtitle">Liste des services-type rattachés (#{creationDeMmpMB.listeServiceTypeRattach.size()})</h5>
                                <div class="ui-form-icon flex mb-3 ">
                                    <i class="pi pi-info-circle mr-1 "></i>
                                    <span>Veuillez selectionner les services type ci-dessous et cliquer sur le boutton "Détacher"</span>
                                </div>
                                <p:dataTable var="serveType" scrollable="true" scrollHeight="350"
                                             lazy="true"
                                             value="#{creationDeMmpMB.listeServiceTypeRattach}"
                                             emptyMessage="Aucun service Type rattaché trouvé."
                                             selection="#{creationDeMmpMB.serviceTypeRattachSelec}"
                                             rowKey="#{serveType.ID}"
                                             style="margin-bottom:0; height: 100px">
                                    <p:column selectionMode="multiple"
                                              style="width:16px;text-align:center"/>
                                    <p:column headerText="Nom">
                                        <h:outputText value="#{serveType.libelle}"/>
                                    </p:column>
                                    <p:column headerText="Statut">
                                        <h:outputText
                                                value="#{serveType.statutServiceType.toString()}"/>
                                    </p:column>
                                    <p:column headerText="Statut">
                                        <h:outputText
                                                value="#{serveType.statutServiceType.toString()}"/>
                                    </p:column>
                                </p:dataTable>
                                <div class="p-col-12 p-lg-6 p-md-6">

                                    <p:commandButton value="Détacher" style="width: 100px; margin-top: 70%"
                                                     process="serviceTypeRattacheForm"
                                                     update="serviceTypeRattacheForm,editMiniPlace:serviceTypeNonRattacheForm"
                                                     disabled="#{creationDeMmpMB.listeServiceTypeRattach.size() == 0}"
                                                     action="#{creationDeMmpMB.detacherServiceTypes()}"
                                                     icon="pi pi-trash"/>
                                </div>
                            </h:form>
                        </div>
                        <!--rattacher/detacher services types : service types rattachés-->
                    </div>

                </p:tab>
                <!--tab : services types-->

                <!--tab : activation des services-->
                <p:tab title="Activation des mini-places de marché">
                    <h:form id="activerDesactiverForm">
                        <div class="grid">
                            <div class="col-12">
                                <!--Champ annotation/commentaire-->
                                <div class="ui-fluid">
                                    <div class="field">
                                        <p:outputLabel for="@next" value="Faire annotation"/>
                                        <p:inputTextarea id="cov" value="#{creationDeMmpMB.annotation.commentaire}"
                                                         required="true"
                                                         requiredMessage="Veuillez saisir un commentaire"
                                                         placeholder="Saisir un commentaire..." rows="5" cols="255"/>
                                    </div>
                                </div>
                                <!--Champ annotation/commentaire-->

                                <!--btn Activer,Annuler,Désavtiver-->
                                <div class="flex justify-content-start flex-wrap mt-2">
                                    <p:commandButton value="Activer" icon="pi pi-lock"
                                                     disabled="#{creationDeMmpMB.mmp.statutMmp == 'ACTIVE'}"
                                                     action="#{creationDeMmpMB.activerUneMmp()}"
                                                     process="activerDesactiverForm" styleClass="w-auto mr-2"
                                                     update="miniplaceForm"/>

                                    <p:commandButton value="Annuler" icon="pi pi-times"
                                                     update="activerDesactiverForm,miniplaceForm"
                                                     process="@this" styleClass="w-auto mr-2"
                                                     action="#{creationDeMmpMB.reset()}"/>

                                    <p:commandButton value="Désactiver" icon="pi pi-unlock"
                                                     disabled="#{creationDeMmpMB.mmp.statutMmp == 'INACTIVE'}"
                                                     action="#{creationDeMmpMB.desactiverUneMmp()}"
                                                     process="activerDesactiverForm" styleClass="w-auto mr-2"
                                                     update="miniplaceForm"/>
                                </div>
                                <!--btn Activer,Annuler,Désavtiver-->
                            </div>
                        </div>
                    </h:form>
                </p:tab>
                <!--tab : activation des services-->
            </p:tabView>
            <!--tabView pour services types et Activation des services-->
        </p:sidebar>
        <!-- Sidebar pour Activer/Désactiver une mini-place de marché -->

    </ui:define>

</ui:composition>
